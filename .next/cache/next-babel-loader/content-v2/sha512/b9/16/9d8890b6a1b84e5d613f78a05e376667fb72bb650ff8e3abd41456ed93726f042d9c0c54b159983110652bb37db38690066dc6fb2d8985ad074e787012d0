{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"C:/Users/stefa/Documents/gitlab/WBS/ServerSide/CodePen_Next/my-code-pen/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/stefa/Documents/gitlab/WBS/ServerSide/CodePen_Next/my-code-pen/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\stefa\\\\Documents\\\\gitlab\\\\WBS\\\\ServerSide\\\\CodePen_Next\\\\my-code-pen\\\\pages\\\\index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { useRouter } from \"next/router\";\nimport SplitPane from \"react-split-pane\";\nimport { CssEditor, HtmlEditor, JavascriptEditor } from \"../components/Editors\";\nimport { useDebounce } from \"../utils/useDebounce\";\nimport styles from \"./index.module.css\";\nimport FingerprintJS from \"@fingerprintjs/fingerprintjs\";\nimport { BsTrash } from \"react-icons/bs\";\n\nvar Index = function Index() {\n  _s();\n\n  var _useState = useState(\"485px\"),\n      heightValue = _useState[0],\n      setHeightValue = _useState[1];\n\n  var _useState2 = useState(true),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(false),\n      saving = _useState3[0],\n      setSaving = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      htmlValue = _useState4[0],\n      setHtmlValue = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      jsValue = _useState5[0],\n      setJsValue = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      cssValue = _useState6[0],\n      setCssValue = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      paneValues = _useState7[0],\n      setpaneValues = _useState7[1];\n\n  var _useState8 = useState(\"\"),\n      userID = _useState8[0],\n      setUserID = _useState8[1];\n\n  var _useState9 = useState([]),\n      project = _useState9[0],\n      setProject = _useState9[1];\n\n  var _useState10 = useState(\"\"),\n      projectID = _useState10[0],\n      setProjectID = _useState10[1];\n\n  var _useState11 = useState(\"\"),\n      projectName = _useState11[0],\n      setProjectName = _useState11[1];\n\n  var debouncedHtml = useDebounce(htmlValue, 1000);\n  var debouncedJs = useDebounce(jsValue, 1000);\n  var debouncedCss = useDebounce(cssValue, 1000);\n  var router = useRouter();\n\n  var _useState12 = useState(\"\"),\n      visitorID = _useState12[0],\n      setVisitorID = _useState12[1];\n\n  var _router$query = router.query,\n      id = _router$query.id,\n      user_id = _router$query.user_id;\n\n  function onChange(event) {\n    if (event.target.value != \"\") {\n      router.push(\"?id=\".concat(event.target.value, \"&user_id=\").concat(userID));\n      setProjectID(event.target.value);\n    } else {\n      location.href = \"/\";\n      setProjectID(\"\");\n    }\n  }\n\n  function onDelete(_x) {\n    return _onDelete.apply(this, arguments);\n  }\n\n  function _onDelete() {\n    _onDelete = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(id) {\n      var requestOptions, response, _yield$response$json4, success, data;\n\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              requestOptions = {\n                method: \"DELETE\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                }\n              };\n              _context4.next = 3;\n              return fetch(\"../api/pens/\".concat(id), requestOptions);\n\n            case 3:\n              response = _context4.sent;\n              _context4.next = 6;\n              return response.json();\n\n            case 6:\n              _yield$response$json4 = _context4.sent;\n              success = _yield$response$json4.success;\n              data = _yield$response$json4.data;\n\n              if (success) {\n                location.href = \"/\";\n                setProjectID(\"\");\n              }\n\n            case 10:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n    return _onDelete.apply(this, arguments);\n  }\n\n  function getProjects() {\n    return _getProjects.apply(this, arguments);\n  }\n\n  function _getProjects() {\n    _getProjects = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      var fp, result, visitorId, requestOptions, response, _yield$response$json5, data;\n\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return FingerprintJS.load();\n\n            case 2:\n              fp = _context5.sent;\n              _context5.next = 5;\n              return fp.get();\n\n            case 5:\n              result = _context5.sent;\n              // This is the visitor identifier:\n              visitorId = result.visitorId;\n              setUserID(visitorId);\n              requestOptions = {\n                method: \"GET\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                }\n              }; // const response = await fetch(`../api/users/${visitorId}`, requestOptions);\n\n              _context5.next = 11;\n              return fetch(\"../api/users/\".concat(visitorId), requestOptions);\n\n            case 11:\n              response = _context5.sent;\n              _context5.next = 14;\n              return response.json();\n\n            case 14:\n              _yield$response$json5 = _context5.sent;\n              data = _yield$response$json5.data;\n              setProject(data);\n\n            case 17:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n    return _getProjects.apply(this, arguments);\n  }\n\n  useEffect(function () {\n    function fetchData() {\n      return _fetchData.apply(this, arguments);\n    }\n\n    function _fetchData() {\n      _fetchData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var response, _yield$response$json, data;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return fetch(\"../api/pens/\".concat(id));\n\n              case 2:\n                response = _context.sent;\n                _context.next = 5;\n                return response.json();\n\n              case 5:\n                _yield$response$json = _context.sent;\n                data = _yield$response$json.data;\n\n                if (!(response.status !== 200)) {\n                  _context.next = 10;\n                  break;\n                }\n\n                _context.next = 10;\n                return router.push(\"/404\");\n\n              case 10:\n                setProjectName(data.projectName);\n                setHtmlValue(data.html);\n                setCssValue(data.css);\n                setJsValue(data.js);\n                setProjectID(id);\n                setLoading(false);\n\n              case 16:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _fetchData.apply(this, arguments);\n    }\n\n    if (id) {\n      setLoading(true);\n      fetchData();\n    } else {\n      setLoading(false);\n    }\n  }, [id]);\n  useEffect(function () {\n    if (router.query) {\n      setVisitorID(router.query.user_id);\n    }\n  }, [user_id]);\n  useEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    var paneOutput;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            // console.log('css js html changed AND paneOutput is SET with paneOutput beeing ')\n            paneOutput = \"<html>\\n                    <style>\\n                    \".concat(debouncedCss, \"\\n                    </style>\\n                    <body>\\n                    \").concat(debouncedHtml, \"\\n                    <script type=\\\"text/javascript\\\">\\n                    \").concat(debouncedJs, \"\\n                    </script>\\n                    </body>\\n                  </html>\");\n            setpaneValues(paneOutput);\n            getProjects();\n\n          case 3:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  })), [debouncedHtml, debouncedCss, debouncedJs]);\n\n  var save = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var meth, requestOptions, response, _yield$response$json2, _yield$response$json3, updatedRecord, newRecordId;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              setSaving(true);\n              meth = \"PUT\";\n\n              if (visitorID) {\n                if (visitorID == userID) {\n                  meth = !id ? \"PUT\" : \"POST\";\n                } else {\n                  meth = \"PUT\";\n                }\n              } else {\n                meth = \"PUT\";\n              }\n\n              if (!(projectName == \"\")) {\n                _context3.next = 9;\n                break;\n              }\n\n              alert(\"Please input project name\");\n              setSaving(false);\n              return _context3.abrupt(\"return\", false);\n\n            case 9:\n              if (!(htmlValue == \"\")) {\n                _context3.next = 15;\n                break;\n              }\n\n              alert(\"Please add html file\");\n              setSaving(false);\n              return _context3.abrupt(\"return\", false);\n\n            case 15:\n              if (!(jsValue == \"\")) {\n                _context3.next = 21;\n                break;\n              }\n\n              alert(\"Please add js file\");\n              setSaving(false);\n              return _context3.abrupt(\"return\", false);\n\n            case 21:\n              if (!(cssValue == \"\")) {\n                _context3.next = 25;\n                break;\n              }\n\n              alert(\"Please add css file\");\n              setSaving(false);\n              return _context3.abrupt(\"return\", false);\n\n            case 25:\n              requestOptions = {\n                method: meth,\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                  html: htmlValue,\n                  css: cssValue,\n                  js: jsValue,\n                  id: id,\n                  userID: userID,\n                  projectName: projectName\n                })\n              };\n              _context3.next = 28;\n              return fetch(\"../api/pens/\".concat(id), requestOptions);\n\n            case 28:\n              response = _context3.sent;\n              _context3.next = 31;\n              return response.json();\n\n            case 31:\n              _yield$response$json2 = _context3.sent;\n              _yield$response$json3 = _yield$response$json2.data;\n              updatedRecord = _yield$response$json3.updatedRecord;\n              newRecordId = _yield$response$json3.newRecordId;\n              setSaving(false);\n\n              if (updatedRecord) {\n                _context3.next = 39;\n                break;\n              }\n\n              _context3.next = 39;\n              return router.push(\"?id=\".concat(newRecordId, \"&user_id=\").concat(userID));\n\n            case 39:\n              getProjects();\n\n            case 40:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function save() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.loading,\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 12\n    }, _this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.header,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: styles.button,\n          onClick: function onClick() {\n            setProjectID(\"\");\n            location.href = \"/\";\n          },\n          children: \"New\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: styles.button,\n          onClick: save,\n          children: saving ? \"Saving...\" : \"Save\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"custom-select\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"form-control form-input\",\n          value: projectName,\n          placeholder: \"Project name\",\n          onChange: function onChange(e) {\n            setProjectName(e.target.value);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 11\n        }, _this), project && project.length > 0 && /*#__PURE__*/_jsxDEV(\"select\", {\n          className: \"form-control form-input\",\n          style: {\n            width: 240\n          },\n          value: projectID ? projectID : \"\",\n          onChange: onChange,\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\",\n            children: \"ProjectID\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 15\n          }, _this), project.map(function (item, i) {\n            return /*#__PURE__*/_jsxDEV(\"option\", {\n              value: item._id,\n              children: item._id\n            }, i, false, {\n              fileName: _jsxFileName,\n              lineNumber: 218,\n              columnNumber: 19\n            }, _this);\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 13\n        }, _this), project && project.length > 0 && /*#__PURE__*/_jsxDEV(BsTrash, {\n          style: {\n            color: \"white\",\n            fontSize: 36\n          },\n          onClick: function onClick() {\n            return onDelete(projectID);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 45\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(SplitPane, {\n      style: {\n        marginTop: \"60px\"\n      },\n      split: \"horizontal\",\n      minSize: \"50%\",\n      onDragFinished: function onDragFinished(height) {\n        setHeightValue(\"\".concat(height - 40, \"px\"));\n      },\n      children: [/*#__PURE__*/_jsxDEV(SplitPane, {\n        split: \"vertical\",\n        minSize: \"33%\",\n        children: [/*#__PURE__*/_jsxDEV(HtmlEditor, {\n          height: heightValue,\n          value: htmlValue,\n          onChange: setHtmlValue\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(SplitPane, {\n          split: \"vertical\",\n          minSize: \"50%\",\n          children: [/*#__PURE__*/_jsxDEV(CssEditor, {\n            height: heightValue,\n            value: cssValue,\n            onChange: setCssValue\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 244,\n            columnNumber: 13\n          }, _this), /*#__PURE__*/_jsxDEV(JavascriptEditor, {\n            height: heightValue,\n            value: jsValue,\n            onChange: setJsValue\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 13\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(\"iframe\", {\n        srcDoc: paneValues,\n        className: styles.previewIframe\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 256,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(Index, \"sZXATD4xszW3JI/mjv6h445+d20=\", false, function () {\n  return [useDebounce, useDebounce, useDebounce, useRouter];\n});\n\n_c = Index;\nexport default Index;\n\nvar _c;\n\n$RefreshReg$(_c, \"Index\");","map":{"version":3,"sources":["C:/Users/stefa/Documents/gitlab/WBS/ServerSide/CodePen_Next/my-code-pen/pages/index.js"],"names":["React","useState","useEffect","useRouter","SplitPane","CssEditor","HtmlEditor","JavascriptEditor","useDebounce","styles","FingerprintJS","BsTrash","Index","heightValue","setHeightValue","loading","setLoading","saving","setSaving","htmlValue","setHtmlValue","jsValue","setJsValue","cssValue","setCssValue","paneValues","setpaneValues","userID","setUserID","project","setProject","projectID","setProjectID","projectName","setProjectName","debouncedHtml","debouncedJs","debouncedCss","router","visitorID","setVisitorID","query","id","user_id","onChange","event","target","value","push","location","href","onDelete","requestOptions","method","headers","fetch","response","json","success","data","getProjects","load","fp","get","result","visitorId","fetchData","status","html","css","js","paneOutput","save","meth","alert","body","JSON","stringify","updatedRecord","newRecordId","header","button","e","length","width","map","item","i","_id","color","fontSize","marginTop","height","previewIframe"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useRouter } from \"next/router\";\nimport SplitPane from \"react-split-pane\";\n\nimport { CssEditor, HtmlEditor, JavascriptEditor } from \"../components/Editors\";\nimport { useDebounce } from \"../utils/useDebounce\";\n\nimport styles from \"./index.module.css\";\nimport FingerprintJS from \"@fingerprintjs/fingerprintjs\";\n\nimport { BsTrash } from \"react-icons/bs\";\n\nconst Index = () => {\n  const [heightValue, setHeightValue] = useState(\"485px\");\n\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n\n  const [htmlValue, setHtmlValue] = useState(\"\");\n  const [jsValue, setJsValue] = useState(\"\");\n  const [cssValue, setCssValue] = useState(\"\");\n  const [paneValues, setpaneValues] = useState(\"\");\n  const [userID, setUserID] = useState(\"\");\n  const [project, setProject] = useState([]);\n  const [projectID, setProjectID] = useState(\"\");\n  const [projectName, setProjectName] = useState(\"\")\n\n  const debouncedHtml = useDebounce(htmlValue, 1000);\n  const debouncedJs = useDebounce(jsValue, 1000);\n  const debouncedCss = useDebounce(cssValue, 1000);\n\n  const router = useRouter();\n  const [visitorID, setVisitorID] = useState(\"\");\n  const { id, user_id } = router.query;\n\n  function onChange(event) {\n    if (event.target.value != \"\") {\n      router.push(`?id=${event.target.value}&user_id=${userID}`);\n      setProjectID(event.target.value);\n    } else {\n      location.href = \"/\";\n      setProjectID(\"\");\n    }\n  }\n\n  async function onDelete(id) {\n    const requestOptions = {\n      method: \"DELETE\",\n      headers: { \"Content-Type\": \"application/json\" },\n    };\n    const response = await fetch(`../api/pens/${id}`, requestOptions);\n    const { success, data } = await response.json();\n    if (success) {\n      location.href = \"/\";\n      setProjectID(\"\");\n    }\n  }\n\n  async function getProjects() {\n    const fp = await FingerprintJS.load();\n\n    // The FingerprintJS agent is ready.\n    // Get a visitor identifier when you'd like to.\n    const result = await fp.get();\n\n    // This is the visitor identifier:\n    const visitorId = result.visitorId;\n    setUserID(visitorId);\n    const requestOptions = {\n      method: \"GET\",\n      headers: { \"Content-Type\": \"application/json\" },\n    };\n    // const response = await fetch(`../api/users/${visitorId}`, requestOptions);\n    const response = await fetch(`../api/users/${visitorId}`, requestOptions);\n    const { data } = await response.json();\n    setProject(data);\n  }\n\n  useEffect(() => {\n    async function fetchData() {\n      const response = await fetch(`../api/pens/${id}`);\n      const { data } = await response.json();\n      if (response.status !== 200) {\n        await router.push(\"/404\");\n      }\n      setProjectName(data.projectName)\n\n      setHtmlValue(data.html);\n      setCssValue(data.css);\n      setJsValue(data.js);\n      setProjectID(id);\n\n      setLoading(false);\n    }\n\n    if (id) {\n      setLoading(true);\n      fetchData();\n    } else {\n      setLoading(false);\n    }\n  }, [id]);\n\n  useEffect(() => {\n    if (router.query) {\n      setVisitorID(router.query.user_id);\n    }\n  }, [user_id]);\n\n  useEffect(async () => {\n    // console.log('css js html changed AND paneOutput is SET with paneOutput beeing ')\n    const paneOutput = `<html>\n                    <style>\n                    ${debouncedCss}\n                    </style>\n                    <body>\n                    ${debouncedHtml}\n                    <script type=\"text/javascript\">\n                    ${debouncedJs}\n                    </script>\n                    </body>\n                  </html>`;\n    setpaneValues(paneOutput);\n\n    getProjects();\n  }, [debouncedHtml, debouncedCss, debouncedJs]);\n\n  const save = async () => {\n    setSaving(true);\n    var meth = \"PUT\";\n    if (visitorID) {\n      if (visitorID == userID) {\n        meth = !id ? \"PUT\" : \"POST\";\n      } else {\n        meth = \"PUT\";\n      }\n    } else {\n      meth = \"PUT\";\n    }\n\n    if (projectName == \"\") {\n      alert(\"Please input project name\");\n      setSaving(false);\n      return false;\n    } else if (htmlValue == \"\") {\n      alert(\"Please add html file\");\n      setSaving(false);\n      return false;\n    }\n    else if (jsValue == \"\") {\n      alert(\"Please add js file\");\n      setSaving(false);\n      return false;\n    } else if (cssValue == \"\") {\n      alert(\"Please add css file\");\n      setSaving(false);\n      return false;\n    }\n\n    const requestOptions = {\n      method: meth,\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        html: htmlValue,\n        css: cssValue,\n        js: jsValue,\n        id: id,\n        userID: userID,\n        projectName: projectName\n      }),\n    };\n    const response = await fetch(`../api/pens/${id}`, requestOptions);\n    const {\n      data: { updatedRecord, newRecordId },\n    } = await response.json();\n\n    setSaving(false);\n    if (!updatedRecord) {\n      await router.push(`?id=${newRecordId}&user_id=${userID}`);\n    }\n    getProjects();\n  };\n\n  if (loading) {\n    return <div className={styles.loading}>Loading...</div>;\n  }\n\n  return (\n    <>\n      <div className={styles.header}>\n        <div>\n          <button\n            className={styles.button}\n            onClick={() => {\n              setProjectID(\"\");\n              location.href = \"/\";\n            }}\n          >\n            New\n          </button>\n          <button className={styles.button} onClick={save}>\n            {saving ? \"Saving...\" : \"Save\"}\n          </button>\n\n        </div>\n        <div className=\"custom-select\">\n          <input className=\"form-control form-input\" value={projectName} placeholder=\"Project name\" onChange={(e) => { setProjectName(e.target.value) }}></input>\n          {project && project.length > 0 && (\n            <select\n              className=\"form-control form-input\"\n              style={{ width: 240 }}\n              value={projectID ? projectID : \"\"}\n              onChange={onChange}\n            >\n              <option value=\"\">ProjectID</option>\n              {project.map((item, i) => {\n                return (\n                  <option key={i} value={item._id}>\n                    {item._id}\n                  </option>\n                );\n              })}\n            </select>\n          )}\n\n          {project && project.length > 0 && <BsTrash style={{ color: \"white\", fontSize: 36 }} onClick={() => onDelete(projectID)}/>}\n        </div>\n      </div>\n      <SplitPane\n        style={{ marginTop: \"60px\" }}\n        split=\"horizontal\"\n        minSize={\"50%\"}\n        onDragFinished={(height) => {\n          setHeightValue(`${height - 40}px`);\n        }}\n      >\n        <SplitPane split=\"vertical\" minSize={\"33%\"}>\n          <HtmlEditor\n            height={heightValue}\n            value={htmlValue}\n            onChange={setHtmlValue}\n          />\n          <SplitPane split=\"vertical\" minSize={\"50%\"}>\n            <CssEditor\n              height={heightValue}\n              value={cssValue}\n              onChange={setCssValue}\n            />\n            <JavascriptEditor\n              height={heightValue}\n              value={jsValue}\n              onChange={setJsValue}\n            />\n          </SplitPane>\n        </SplitPane>\n        <iframe srcDoc={paneValues} className={styles.previewIframe} />\n      </SplitPane>\n    </>\n  );\n};\n\nexport default Index;\n"]},"metadata":{},"sourceType":"module"}