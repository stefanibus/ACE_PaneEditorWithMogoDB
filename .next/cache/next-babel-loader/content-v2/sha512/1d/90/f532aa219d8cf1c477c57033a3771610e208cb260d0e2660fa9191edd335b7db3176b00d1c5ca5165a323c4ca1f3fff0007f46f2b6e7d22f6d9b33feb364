{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"C:\\\\Users\\\\stefa\\\\Documents\\\\gitlab\\\\WBS\\\\ServerSide\\\\CodePen_Next\\\\my-code-pen\\\\pages\\\\index.js\";\nimport React, { useState, useEffect } from \"react\";\nimport { useRouter } from \"next/router\";\nimport SplitPane from \"react-split-pane\";\nimport { CssEditor, HtmlEditor, JavascriptEditor } from \"../components/Editors\";\nimport { useDebounce } from \"../utils/useDebounce\";\nimport styles from \"./index.module.css\";\nimport FingerprintJS from \"@fingerprintjs/fingerprintjs\";\nimport { BsTrash } from \"react-icons/bs\";\n\nconst Index = () => {\n  const {\n    0: heightValue,\n    1: setHeightValue\n  } = useState(\"485px\");\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(true);\n  const {\n    0: saving,\n    1: setSaving\n  } = useState(false);\n  const {\n    0: htmlValue,\n    1: setHtmlValue\n  } = useState(\"\");\n  const {\n    0: jsValue,\n    1: setJsValue\n  } = useState(\"\");\n  const {\n    0: cssValue,\n    1: setCssValue\n  } = useState(\"\");\n  const {\n    0: paneValues,\n    1: setpaneValues\n  } = useState(\"\");\n  const {\n    0: userID,\n    1: setUserID\n  } = useState(\"\");\n  const {\n    0: project,\n    1: setProject\n  } = useState([]);\n  const {\n    0: projectID,\n    1: setProjectID\n  } = useState(\"\");\n  const {\n    0: projectName,\n    1: setProjectName\n  } = useState(\"\");\n  const debouncedHtml = useDebounce(htmlValue, 1000);\n  const debouncedJs = useDebounce(jsValue, 1000);\n  const debouncedCss = useDebounce(cssValue, 1000);\n  const router = useRouter();\n  const {\n    0: visitorID,\n    1: setVisitorID\n  } = useState(\"\");\n  const {\n    id,\n    user_id\n  } = router.query;\n\n  function onChange(event) {\n    if (event.target.value != \"\") {\n      router.push(`?id=${event.target.value}&user_id=${userID}`);\n      setProjectID(event.target.value);\n    } else {\n      location.href = \"/\";\n      setProjectID(\"\");\n    }\n  }\n\n  async function onDelete(id) {\n    const requestOptions = {\n      method: \"DELETE\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n    const response = await fetch(`../api/pens/${id}`, requestOptions);\n    const {\n      success,\n      data\n    } = await response.json();\n\n    if (success) {\n      location.href = \"/\";\n      setProjectID(\"\");\n    }\n  }\n\n  async function getProjects() {\n    const fp = await FingerprintJS.load(); // The FingerprintJS agent is ready.\n    // Get a visitor identifier when you'd like to.\n\n    const result = await fp.get(); // This is the visitor identifier:\n\n    const visitorId = result.visitorId;\n    setUserID(visitorId);\n    const requestOptions = {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    }; // const response = await fetch(`../api/users/${visitorId}`, requestOptions);\n\n    const response = await fetch(`../api/users/${visitorId}`, requestOptions);\n    const {\n      data\n    } = await response.json();\n    setProject(data);\n  }\n\n  useEffect(() => {\n    async function fetchData() {\n      const response = await fetch(`../api/pens/${id}`);\n      const {\n        data\n      } = await response.json();\n\n      if (response.status !== 200) {\n        await router.push(\"/404\");\n      }\n\n      setProjectName(data.projectName);\n      setHtmlValue(data.html);\n      setCssValue(data.css);\n      setJsValue(data.js);\n      setProjectID(id);\n      setLoading(false);\n    }\n\n    if (id) {\n      setLoading(true);\n      fetchData();\n    } else {\n      setLoading(false);\n    }\n  }, [id]);\n  useEffect(() => {\n    if (router.query) {\n      setVisitorID(router.query.user_id);\n    }\n  }, [user_id]);\n  useEffect(() => {\n    // console.log('css js html changed AND paneOutput is SET with paneOutput beeing ')\n    const paneOutput = `<html>\n                    <style>\n                    ${debouncedCss}\n                    </style>\n                    <body>\n                    ${debouncedHtml}\n                    <script type=\"text/javascript\">\n                    ${debouncedJs}\n                    </script>\n                    </body>\n                  </html>`;\n    setpaneValues(paneOutput);\n    getProjects();\n  }, [debouncedHtml, debouncedCss, debouncedJs]);\n\n  const save = async () => {\n    setSaving(true);\n    var meth = \"PUT\";\n\n    if (visitorID) {\n      if (visitorID == userID) {\n        meth = !id ? \"PUT\" : \"POST\";\n      } else {\n        meth = \"PUT\";\n      }\n    } else {\n      meth = \"PUT\";\n    }\n\n    const requestOptions = {\n      method: meth,\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        html: htmlValue,\n        css: cssValue,\n        js: jsValue,\n        id: id,\n        userID: userID,\n        projectName: projectName\n      })\n    };\n    const response = await fetch(`../api/pens/${id}`, requestOptions);\n    const {\n      data: {\n        updatedRecord,\n        newRecordId\n      }\n    } = await response.json();\n    setSaving(false);\n\n    if (!updatedRecord) {\n      await router.push(`?id=${newRecordId}&user_id=${userID}`);\n    }\n\n    getProjects();\n  };\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.loading,\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 12\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.header,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: styles.button,\n          onClick: () => {\n            setProjectID(\"\");\n            location.href = \"/\";\n          },\n          children: \"New\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: styles.button,\n          onClick: save,\n          children: saving ? \"Saving...\" : \"Save\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"custom-select\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"form-control form-input\",\n          value: projectName,\n          placeholder: \"Project name\",\n          onChange: e => {\n            setProjectName(e.target.value);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 11\n        }, this), project && project.length > 0 && /*#__PURE__*/_jsxDEV(\"select\", {\n          className: \"form-control form-input\",\n          style: {\n            width: 240\n          },\n          value: projectID ? projectID : \"\",\n          onChange: onChange,\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\",\n            children: \"ProjectID\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 197,\n            columnNumber: 15\n          }, this), project.map((item, i) => {\n            return /*#__PURE__*/_jsxDEV(\"option\", {\n              value: item._id,\n              children: item._id\n            }, i, false, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 19\n            }, this);\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 13\n        }, this), project && project.length > 0 && /*#__PURE__*/_jsxDEV(BsTrash, {\n          style: {\n            color: \"white\",\n            fontSize: 36\n          },\n          onClick: () => onDelete(projectID)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 45\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SplitPane, {\n      style: {\n        marginTop: \"60px\"\n      },\n      split: \"horizontal\",\n      minSize: \"50%\",\n      onDragFinished: height => {\n        setHeightValue(`${height - 40}px`);\n      },\n      children: [/*#__PURE__*/_jsxDEV(SplitPane, {\n        split: \"vertical\",\n        minSize: \"33%\",\n        children: [/*#__PURE__*/_jsxDEV(HtmlEditor, {\n          height: heightValue,\n          value: htmlValue,\n          onChange: setHtmlValue\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(SplitPane, {\n          split: \"vertical\",\n          minSize: \"50%\",\n          children: [/*#__PURE__*/_jsxDEV(CssEditor, {\n            height: heightValue,\n            value: cssValue,\n            onChange: setCssValue\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 226,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(JavascriptEditor, {\n            height: heightValue,\n            value: jsValue,\n            onChange: setJsValue\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"iframe\", {\n        srcDoc: paneValues,\n        className: styles.previewIframe\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\nexport default Index;","map":{"version":3,"sources":["C:/Users/stefa/Documents/gitlab/WBS/ServerSide/CodePen_Next/my-code-pen/pages/index.js"],"names":["React","useState","useEffect","useRouter","SplitPane","CssEditor","HtmlEditor","JavascriptEditor","useDebounce","styles","FingerprintJS","BsTrash","Index","heightValue","setHeightValue","loading","setLoading","saving","setSaving","htmlValue","setHtmlValue","jsValue","setJsValue","cssValue","setCssValue","paneValues","setpaneValues","userID","setUserID","project","setProject","projectID","setProjectID","projectName","setProjectName","debouncedHtml","debouncedJs","debouncedCss","router","visitorID","setVisitorID","id","user_id","query","onChange","event","target","value","push","location","href","onDelete","requestOptions","method","headers","response","fetch","success","data","json","getProjects","fp","load","result","get","visitorId","fetchData","status","html","css","js","paneOutput","save","meth","body","JSON","stringify","updatedRecord","newRecordId","header","button","e","length","width","map","item","i","_id","color","fontSize","marginTop","height","previewIframe"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useRouter } from \"next/router\";\nimport SplitPane from \"react-split-pane\";\n\nimport { CssEditor, HtmlEditor, JavascriptEditor } from \"../components/Editors\";\nimport { useDebounce } from \"../utils/useDebounce\";\n\nimport styles from \"./index.module.css\";\nimport FingerprintJS from \"@fingerprintjs/fingerprintjs\";\n\nimport { BsTrash } from \"react-icons/bs\";\n\nconst Index = () => {\n  const [heightValue, setHeightValue] = useState(\"485px\");\n\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n\n  const [htmlValue, setHtmlValue] = useState(\"\");\n  const [jsValue, setJsValue] = useState(\"\");\n  const [cssValue, setCssValue] = useState(\"\");\n  const [paneValues, setpaneValues] = useState(\"\");\n  const [userID, setUserID] = useState(\"\");\n  const [project, setProject] = useState([]);\n  const [projectID, setProjectID] = useState(\"\");\n  const [projectName, setProjectName] = useState(\"\")\n\n  const debouncedHtml = useDebounce(htmlValue, 1000);\n  const debouncedJs = useDebounce(jsValue, 1000);\n  const debouncedCss = useDebounce(cssValue, 1000);\n\n  const router = useRouter();\n  const [visitorID, setVisitorID] = useState(\"\");\n  const { id, user_id } = router.query;\n\n  function onChange(event) {\n    if (event.target.value != \"\") {\n      router.push(`?id=${event.target.value}&user_id=${userID}`);\n      setProjectID(event.target.value);\n    } else {\n      location.href = \"/\";\n      setProjectID(\"\");\n    }\n  }\n\n  async function onDelete(id) {\n    const requestOptions = {\n      method: \"DELETE\",\n      headers: { \"Content-Type\": \"application/json\" },\n    };\n    const response = await fetch(`../api/pens/${id}`, requestOptions);\n    const { success, data } = await response.json();\n    if (success) {\n      location.href = \"/\";\n      setProjectID(\"\");\n    }\n  }\n\n  async function getProjects() {\n    const fp = await FingerprintJS.load();\n\n    // The FingerprintJS agent is ready.\n    // Get a visitor identifier when you'd like to.\n    const result = await fp.get();\n\n    // This is the visitor identifier:\n    const visitorId = result.visitorId;\n    setUserID(visitorId);\n    const requestOptions = {\n      method: \"GET\",\n      headers: { \"Content-Type\": \"application/json\" },\n    };\n    // const response = await fetch(`../api/users/${visitorId}`, requestOptions);\n    const response = await fetch(`../api/users/${visitorId}`, requestOptions);\n    const { data } = await response.json();\n    setProject(data);\n  }\n\n  useEffect(() => {\n    async function fetchData() {\n      const response = await fetch(`../api/pens/${id}`);\n      const { data } = await response.json();\n      if (response.status !== 200) {\n        await router.push(\"/404\");\n      }\n      setProjectName(data.projectName)\n\n      setHtmlValue(data.html);\n      setCssValue(data.css);\n      setJsValue(data.js);\n      setProjectID(id);\n\n      setLoading(false);\n    }\n\n    if (id) {\n      setLoading(true);\n      fetchData();\n    } else {\n      setLoading(false);\n    }\n  }, [id]);\n\n  useEffect(() => {\n    if (router.query) {\n      setVisitorID(router.query.user_id);\n    }\n  }, [user_id]);\n\n  useEffect( () => {\n    // console.log('css js html changed AND paneOutput is SET with paneOutput beeing ')\n    const paneOutput = `<html>\n                    <style>\n                    ${debouncedCss}\n                    </style>\n                    <body>\n                    ${debouncedHtml}\n                    <script type=\"text/javascript\">\n                    ${debouncedJs}\n                    </script>\n                    </body>\n                  </html>`;\n    setpaneValues(paneOutput);\n\n    getProjects();\n  }, [debouncedHtml, debouncedCss, debouncedJs]);\n\n  const save = async () => {\n    setSaving(true);\n    var meth = \"PUT\";\n    if (visitorID) {\n      if (visitorID == userID) {\n        meth = !id ? \"PUT\" : \"POST\";\n      } else {\n        meth = \"PUT\";\n      }\n    } else {\n      meth = \"PUT\";\n    }\n\n\n    const requestOptions = {\n      method: meth,\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        html: htmlValue,\n        css: cssValue,\n        js: jsValue,\n        id: id,\n        userID: userID,\n        projectName: projectName\n      }),\n    };\n    const response = await fetch(`../api/pens/${id}`, requestOptions);\n    const {\n      data: { updatedRecord, newRecordId },\n    } = await response.json();\n\n    setSaving(false);\n    if (!updatedRecord) {\n      await router.push(`?id=${newRecordId}&user_id=${userID}`);\n    }\n    getProjects();\n  };\n\n  if (loading) {\n    return <div className={styles.loading}>Loading...</div>;\n  }\n\n  return (\n    <>\n      <div className={styles.header}>\n        <div>\n          <button\n            className={styles.button}\n            onClick={() => {\n              setProjectID(\"\");\n              location.href = \"/\";\n            }}\n          >\n            New\n          </button>\n          <button className={styles.button} onClick={save}>\n            {saving ? \"Saving...\" : \"Save\"}\n          </button>\n\n        </div>\n        <div className=\"custom-select\">\n          <input className=\"form-control form-input\" value={projectName} placeholder=\"Project name\" onChange={(e) => { setProjectName(e.target.value) }}></input>\n          {project && project.length > 0 && (\n            <select\n              className=\"form-control form-input\"\n              style={{ width: 240 }}\n              value={projectID ? projectID : \"\"}\n              onChange={onChange}\n            >\n              <option value=\"\">ProjectID</option>\n              {project.map((item, i) => {\n                return (\n                  <option key={i} value={item._id}>\n                    {item._id}\n                  </option>\n                );\n              })}\n            </select>\n          )}\n\n          {project && project.length > 0 && <BsTrash style={{ color: \"white\", fontSize: 36 }} onClick={() => onDelete(projectID)}/>}\n        </div>\n      </div>\n      <SplitPane\n        style={{ marginTop: \"60px\" }}\n        split=\"horizontal\"\n        minSize={\"50%\"}\n        onDragFinished={(height) => {\n          setHeightValue(`${height - 40}px`);\n        }}\n      >\n        <SplitPane split=\"vertical\" minSize={\"33%\"}>\n          <HtmlEditor\n            height={heightValue}\n            value={htmlValue}\n            onChange={setHtmlValue}\n          />\n          <SplitPane split=\"vertical\" minSize={\"50%\"}>\n            <CssEditor\n              height={heightValue}\n              value={cssValue}\n              onChange={setCssValue}\n            />\n            <JavascriptEditor\n              height={heightValue}\n              value={jsValue}\n              onChange={setJsValue}\n            />\n          </SplitPane>\n        </SplitPane>\n        <iframe srcDoc={paneValues} className={styles.previewIframe} />\n      </SplitPane>\n    </>\n  );\n};\n\nexport default Index;\n"]},"metadata":{},"sourceType":"module"}